# ChordFinder.find()

→[ChordFinder実装全般](chordfinder.md)

## 概要

- find( (Chord) chord )
  - 返り値：(ChordName array) コードネームの配列
  - 渡されたコード構成音とルート音から、該当する全てのコードネームの配列を返す

## アルゴリズム詳細

（以下メジャーコードを M と表記する）

- ①構成音から長２度～増５度の音程の二和音を列挙する（並び変え可）
  - Chord クラスの構成音は C ～ B を 0 ～ 11 で表現した Set オブジェクトとして格納されているため、構成音のうちあらゆる2音の組み合わせの値の差を求める
    - この差は、つまり２つの音が何半音離れているかを示す値である
    - よって、差が２半音（長２度）～８半音（増５度）のペアを探せばいいはずである
    - ただし、B と C の間をまたいで長２度～増５度の音程になるようなペア（例えば F と C は完全五度の音程である）についても考慮すると、（12 - 差）が 2 ～ 8 となる場合にも長２度～増５度の音程のペアが存在することがわかる
    - よって、（12 - 10 が 8 であることから）二音の値の差が 2 ～ 10 のとき、二音の間に長２度～増５度のいずれかの音程があることがわかる
    - 以下に二音の値の差と、そのときの二音の音程を列挙する
      - 2：長二度(sus2)
      - 3：短三度(m)
      - 4：長三度(M)、増五度
      - 5：完全四度(sus4)、完全五度
      - 6：減五度(♭5)（どちらをルート音ととっても減五度）
      - 7：完全五度、完全四度
      - 8：増五度(aug)、長三度
      - 9：短三度
      - 10：長二度
    - たとえば二音の値が 0 と 5 だったとき、その音程は完全四度もしくは完全五度のいずれかとして解釈することができるが、この二つは異なる二和音として（ 0、5 のペアと 5、0 のペア）列挙のうちに加える
  - 長２度～増５度の音程の二和音すべてについて、(omit3) もしくは (omit5) のいずれかであるとして仮のコード名を与える
    - 例えば、  
    0、5（C、F）の二和音は Csus4(omit5)、  
    5、0（F、C）の二和音は F(omit3) など
- ②列挙した二和音について、残りの構成音のうち一つを加えてできる三和音を探す
  - ①の行程で (omit3) のついたコードについて（ルート音から数えて）完全五度、(omit5) のついたコードについて短三度や長三度の構成音があれば、それを加えて三和音にできる
  - 三和音になるパターンは以下の通り
    - sus2(omit5) + 完全五度
    - m(omit5) + 完全五度
    - M(omit5) + 完全五度
    - sus4(omit5) + 完全五度
    - (♭5)(omit3) + 短三度
    - M(omit3) + 長三度
    - aug(omit3) + 長三度
  - M(omit5) と M(omit3) が同時にある場合、M が二つできてしまうので片方は破棄する
- ③できた二和音・三和音すべてのコードについて、渡されたものとルート音が違うコードをすべて分数コードにしてルート音を変更する
- ④これらのコードに、残りの構成音を加えてコードを完成させる
  - 加えられるパターンは以下の通り
    - 6（長六度を加える）
    - 7（短七度を加える）
    - M7（長七度を加える）
    - 6、7、M7 のいずれかに加えて
      - (♭9)（短九度＝短二度を加える）
      - (9)（長九度＝長二度を加える）
      - (♯9)（増九度＝短三度を加える）
      - (11)（完全十一度＝完全四度を加える）
      - (♯11)（増十一度＝増四度を加える）
      - (♭13)（短十三度＝短六度を加える）
      - (13)（長十三度＝長六度を加える）
    - 6、7、M7 のないコードに加えて
      - add9（長九度＝長二度を加える）
      - add11（完全十一度＝完全四度を加える）
    - (♭5) のとき、長六度を加えると dim7
  - 分数コードのルート音について、「残りの構成音」に含めない場合と含める場合の両方について考えなければならない
  - 加えられないような構成音が残る場合、そのコードを破棄する
  - M(omit3) は 5 に変換する
